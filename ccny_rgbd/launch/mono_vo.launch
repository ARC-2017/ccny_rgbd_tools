<!-- RGB-D Monocual Visual Odometry -->

<launch>
  #arg name="PATH_TO_PCD" default="$(env HOME)/ros" #
  <arg name="PATH_TO_PCD" default="$(env HOME)/ros/Maps/3D/CCNY Office 640/PCD" />
  #arg name="PCD_NAME" default="office.pcd" # PCD file name (with extension)
  <arg name="PCD_NAME" default="ccny_office_640_loop.pcd" /> # PCD file name (with extension)
  <arg name="FULL_PCD_NAME" default="$(arg PATH_TO_PCD)/$(arg PCD_NAME)" />
  
  # ORB, SURF, GTF, KLT
  <arg name="detector_type" default="GFT"/> 
  
  <node pkg="ccny_rgbd" type="mono_vo_node" name="mono_vo_node" 
    output="screen">

    # Keyframes location:
    #param name="apps/mono_vo/path_to_keyframes" value="$(env HOME)/ros/Maps/3D/CCNY Office/Keyframes/" #
    <param name="apps/mono_vo/path_to_keyframes" value="$(env HOME)/ros/Maps/3D/CCNY Office 640/Keyframes/" />
    <param name="apps/mono_vo/initial_keyframe_number" value="0" /> 
    
    # PCD file location
    <param name="apps/mono_vo/PCD_filename" value="$(arg FULL_PCD_NAME)"/> 
    
    # Publishing options
    # It publishes odometry regardless!
    <param name="apps/mono_vo/publish_cloud_model" value="true"/> 
    <param name="apps/mono_vo/publish_virtual_img" value="true"/> # Not implemented yet 

    # Topics:
    # Camera from bag (no calibration)
    <!--
    <param name="apps/mono_vo/topic_cam_info" value="/camera/rgb/camera_info" />
    <param name="apps/mono_vo/topic_image"  value="/camera/rgb/image_raw" />
    -->
    # Camera with calibration files
    <param name="apps/mono_vo/topic_cam_info" value="/rgbd/info" />
    <param name="apps/mono_vo/topic_image"    value="/rgbd/rgb" />

    # Frames
    <param name="fixed_frame" value="/odom"/>
    <param name="base_frame"  value="/camera_link"/>
       
    ##########################################################################
   
    <param name="apps/mono_vo/image_width"                   value="320" /> 
    <param name="apps/mono_vo/image_height"                  value="240" /> 
    <param name="apps/mono_vo/virtual_image_width"           value="400" /> 
    <param name="apps/mono_vo/virtual_image_height"          value="300" /> 
   
    <!-- works for 0.2 speed (7 FPS)
    <param name="apps/mono_vo/max_ransac_iterations"         value="1000"/>
    <param name="apps/mono_vo/min_inliers_count"             value="50"/>
    <param name="apps/mono_vo/max_reproj_error"              value="2"/>   
    <param name="apps/mono_vo/detector_threshold"            value="800" /> 
    <param name="apps/mono_vo/max_descriptor_space_distance" value="0.5" /> 
    <param name="apps/mono_vo/virtual_image_blur"            value="3"/>
    -->
    
    <!-- works for 0.5 speed (15 FPS)
    <param name="apps/mono_vo/max_ransac_iterations"         value="1000"/>
    <param name="apps/mono_vo/min_inliers_count"             value="50"/>
    <param name="apps/mono_vo/max_reproj_error"              value="2"/>   
    <param name="apps/mono_vo/detector_threshold"            value="800" /> 
    <param name="apps/mono_vo/max_descriptor_space_distance" value="0.5" /> 
    <param name="apps/mono_vo/virtual_image_blur"            value="3"/>
    -->

    <param name="apps/mono_vo/max_ransac_iterations"         value="1000"/>
    <param name="apps/mono_vo/min_inliers_count"             value="50"/>
    <param name="apps/mono_vo/max_reproj_error"              value="2"/>   
    <param name="apps/mono_vo/detector_threshold"            value="800" /> 
    <param name="apps/mono_vo/max_descriptor_space_distance" value="0.5" /> 
    <param name="apps/mono_vo/virtual_image_blur"            value="3"/>
    <param name="apps/mono_vo/virtual_image_fill"            value="3"/>
    
   </node>

</launch>